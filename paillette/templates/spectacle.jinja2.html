{% set spectacle = representations[0] %}
{% set all_dates = (representations | join(',', attribute='representation_dates')).split(',') | sort | list %}
{% set dates = (all_dates[0], all_dates[-1]) | date_range %}
{% set title = '{}, {}'.format(spectacle.place, dates) %}

{% extends '_layout.jinja2' %}

{% block content %}
  <h2>{{ title }}</h2>

  <dl>
    <dt class="date">Date</dt>
    <dd>{{ dates | capitalize }}</dd>
    <dt class="place">Lieu</dt>
    <dd>{{ spectacle.place }}</dd>

    {% if spectacle.travel_time %}
      <dt class="vehicle">Temps de transport</dt>
      <dd>{{ spectacle.travel_time }}</dd>
    {% endif %}
  </dl>

  <dl>
    <dt>Évènement</dt>
    <dd>
      {% if spectacle.event_link %}
        <a href="{{ spectacle.event_link }}">{{ spectacle.event }}</a>
      {% else %}
        {{ spectacle.event }}
      {% endif %}
    </dd>

    {% if spectacle.configuration %}
      <dt>Configuration</dt>
      <dd>{{ spectacle.configuration }}</dd>
    {% endif %}

    {% if spectacle.manager %}
      <dt>Régisseur</dt>
      <dd>{{ spectacle.manager }}</dd>
    {% endif %}

    {% if representations | length >= 2 %}
      <dt>Spectacles</dt>
    {% endif %}
    {% for representation in representations %}
      {% if representations | length >= 2 %}
        <dd>
          <dl>
      {% endif %}
      <dt>Spectacle</dt>
      <dd>{{ representation.representation_name }}</dd>
      <dt>Dates</dt>
      {% if representation.representation_dates %}
        {% for representation_date in representation.representation_dates.split(',') %}
          <dd>{{ representation_date | date_simple }}</dd>
        {% else %}
          <dd>Pas de dates</dd>
        {% endfor %}
      {% endif %}
      <dt>Artistes</dt>
      {% for artist_name_and_phone in representation.artists_name_and_phone.split(',') %}
        {% set name = artist_name_and_phone.split('||')[0] %}
        <dd>{{ name }}</dd>
      {% else %}
        <dd>Pas d’artiste</dd>
      {% endfor %}
      {% if representations | length >= 2 %}
          </dl>
        </dd>
      {% endif %}
    {% else %}
      <dd>Pas de spectacle</dd>
    {% endfor %}

    <dt>Matériel de son</dt>
    {% for sound in sounds %}
      <dd>{{ sound.name }}</dd>
    {% else %}
      <dd>Pas de matériel de son</dd>
    {% endfor %}

    <dt>Boîtes de maquillage</dt>
    {% for makeup in makeups %}
      <dd>{{ makeup.name }}</dd>
    {% else %}
      <dd>Pas de boîte de maquillage</dd>
    {% endfor %}

    <dt>Costumes</dt>
    {% for costume in costumes %}
      <dd>{{ costume.name }}</dd>
    {% else %}
      <dd>Pas de costume</dd>
    {% endfor %}

    {% if spectacle.organizer %}
      <dt>Régisseur</dt>
      <dd>{{ spectacle.organizer }}</dd>
    {% endif %}

    <dt>Départ le</dt>
    <dd>{{ spectacle.date_from | date_simple }}</dd>

    <dt>Retour le</dt>
    <dd>{{ spectacle.date_to | date_simple }}</dd>

    <dt>Véhicules</dt>
    {% for vehicle in vehicles %}
      <dd>{{ vehicle.name }}</dd>
    {% else %}
      <dd>Pas de véhicule</dd>
    {% endfor %}
  </dl>

  <ul class="actions">
    <li><a class="send" href="{{ url_for('roadmap_send', spectacle_id=spectacle.id) }}">Envoyer la feuille de route</a></li>
    <li><a class="update" href="{{ url_for('spectacle_update', spectacle_id=spectacle.id) }}">Éditer le spectacle</a></li>
  </ul>
{% endblock %}
